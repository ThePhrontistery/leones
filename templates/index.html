{% extends "base.html" %} {% block content %}
<div class="w-full min-h-screen h-screen flex flex-col justify-center items-center p-0 m-0 overflow-hidden">
  <div class="grid grid-cols-1 md:grid-cols-12 gap-4 w-full h-full max-h-full">
    <!-- Primera columna: Carga de documentos -->
    <section class="col-span-2 bg-slate-50 rounded-2xl p-6 shadow-lg border border-slate-200 flex flex-col h-full min-h-0">
      <h3 class="font-semibold text-xl text-blue-700 mb-4">
        Carga de documentos
      </h3>
      <div
        id="panel-upload"
        class="flex flex-col items-stretch gap-2 text-slate-400"
      >
        <div class="flex flex-row gap-2 mb-2 justify-start">
          <button
            type="button"
            onclick="window.open('/api/document/upload', '_blank', 'width=500,height=600')"
            class="bg-blue-700 text-white px-2 py-1 text-xs rounded hover:bg-blue-800 transition"
          >
            Abrir carga de documento
          </button>
          <button
            type="button"
            hx-post="/api/document/clear"
            hx-target="#document-list"
            hx-swap="innerHTML"
            class="bg-red-600 text-white px-2 py-1 text-xs rounded hover:bg-red-700 transition"
          >
            Borrar todos
          </button>
          <button
            type="button"
            hx-post="/api/generar-funcional/"
            hx-target="#panel-markdown"
            hx-swap="innerHTML"
            hx-indicator="#generar-funcional-indicador"
            class="bg-green-700 text-white px-2 py-1 text-xs rounded hover:bg-green-800 transition"
          >
            Generar Funcional
          </button>
          <div id="generar-funcional-indicador" class="flex items-center ml-2">
            <!-- Aquí se mostrará el estado: generando..., ok, error -->
          </div>
        </div>
        <div id="upload-result" class="mt-2"></div>
        <div
          id="document-list"
          hx-get="/api/document/list"
          hx-trigger="load,documentUploaded from:body"
          hx-swap="innerHTML"
          class="mt-2"
        ></div>
      </div>
    </section>

    <!-- Segunda columna: Panel Análisis funcional con 3 secciones horizontales -->
    <section class="col-span-8 bg-slate-50 rounded-2xl p-6 shadow-lg border border-slate-200 flex flex-col h-full min-h-0">
      <h3 class="font-semibold text-xl text-blue-700 mb-4">Análisis funcional</h3>
      <div id="panel-markdown" class="flex flex-row gap-4 w-full h-full max-h-full">
        <!-- Sección 1: Árbol de Contenidos -->
        <div class="flex-1 flex flex-col min-h-0 h-full">
          <div class="bg-white rounded-lg shadow p-4 flex-1 flex flex-col">
            <div class="font-semibold text-blue-700 mb-2">Árbol de contenidos</div>
            <div id="panel-tree" class="flex-1 flex items-start justify-start text-slate-400">
              <div id="arbol-contenidos" hx-get="/api/document/arbol-contenidos" hx-trigger="load" hx-swap="innerHTML"></div>
            </div>
          </div>
        </div>
        <!-- Sección 2: Editor Markdown -->
        <div class="flex-1 flex flex-col min-h-0 h-full">
          <div class="bg-white rounded-lg shadow p-4 flex-1 flex flex-col">
            <div class="font-semibold text-blue-700 mb-2">Editor Markdown</div>
            <div id="markdown-editor" class="flex-1 mb-4">
              <!-- Aquí va el editor markdown -->
            </div>
          </div>
        </div>
        <!-- Sección 3: Vista previa -->
        <div class="flex-1 flex flex-col min-h-0 h-full">
          <div class="bg-white rounded-lg shadow p-4 flex-1 flex flex-col">
            <div class="font-semibold text-blue-700 mb-2">Vista previa</div>
            <div id="markdown-preview" class="flex-1 bg-white rounded p-2 border border-slate-200 min-h-[150px]">
              <!-- Aquí va la vista previa del markdown renderizado -->
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Tercera columna: Chat lateral con IA -->
    <section class="col-span-2 bg-slate-50 rounded-2xl p-6 shadow-lg border border-slate-200 flex flex-col h-full min-h-0">
      <h3 class="font-semibold text-xl text-blue-700 mb-4">Chat IA (Agent)</h3>
      <div
        id="panel-chat"
        class="flex-1 flex flex-col items-center justify-center text-slate-400"
      >
        <!-- Vacío al inicio -->
        <button
          type="button"
          hx-post="/api/chat/saludo"
          hx-target="#panel-chat"
          hx-swap="innerHTML"
          class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 transition mb-4"
        >
          Preguntar IA: Saludar
        </button>
        <!-- Aquí irá la respuesta del chat IA -->
      </div>
    </section>
  </div>
</div>
{% endblock %}
